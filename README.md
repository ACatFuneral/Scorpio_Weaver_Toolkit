# 本地化三神器：连草履虫都能学会的保姆级教程

你好，未来的汉化大佬！

还在为手动给成千上万行代码添加翻译符号 `_()` 而头疼吗？  
还在为游戏里人名翻译不统一而抓狂吗？  
还在为汉化后字体变成“口口口”而束手无策吗？  

忘掉那些痛苦吧！

现在为你带来了这套“本地化三神器”组合包，它将为你扫清汉化路上的三大障碍，让你能把宝贵的精力真正投入到“翻译”这件核心工作上。
本工具集的作用是：**自动化地为游戏做好翻译前的所有准备工作。** 它不能帮你翻译，但能让你接下来的翻译过程顺畅百倍！

准备好了吗？让我们开始解放生产力！

---

## 第一步：战前准备 (磨刀不误砍柴工)

在开始之前，你需要准备好以下几样东西：

1.  **Python 环境**: 我们的神器是由Python语言驱动的。如果你的电脑还没有安装，请点击[这里访问官网](https://www.python.org/downloads/)下载并安装。**安装时，请务必勾选 `Add Python to PATH` 这个选项！**
2.  **一个AI账号的API密钥**:
    *   **API Key (密钥)**: 这是一长串像密码一样的字符，是你的AI通行证。
    *   **Base URL (API地址)**: 这是你连接AI服务商的服务器地址。
    *   *(你可以从任何兼容OpenAI格式的AI服务商那里获取，比如火山或其他你信任的服务商。去你妈的火山！)*
3.  **游戏本体**: 当然，你需要准备好你要汉化的游戏文件。
4.  **一份游戏备份**: **血的教训！** 在对游戏做任何修改前，请务必、一定、必须把整个游戏文件夹复制一份作为备份！
5.  **魔法工具**: 节点选择美国，英国地区为佳，如果要用到Gemini的话。
6.  **Google AI Studio**: 地址 -> `https://aistudio.google.com/prompts/new_chat`
7.  **提示词**: 见群文件（具体根据自己风格和需求修改提示词）
8.  **一体化脚本**: 见群文件
9.  **老K的提取工具**: 见群文件
10. **对比工具**: Beyond Compare、WinMerge、VSC自带对比，想用啥用啥，啥顺手用啥。群文件提供一个30天版的Beyond Compare。
11. **Lingua**: 自己去GitHub网站下载

---

## 第二步：启动主力战舰！【自动化本地化预处理工具】

这个工具是我们的核心，它能自动给需要翻译的文本加上 `_()` 标记。

**操作流程：**

1.  **创建脚本文件**:
    在你电脑的任意位置（比如桌面、比如D盘）把自动化本地化预处理工具扔进去，如果你是复制的，切记文件名字不能重复，不然运行会报错，另存为任意非中文名字的`.py`，比如`123.py`、`AAA.py`等。

2.  **进行配置 (最关键的一步！)**:
    用记事本或任何代码编辑器打开脚本文件，找到顶部的**【配置区】**，按要求填入你的信息：
    *   `API_KEY`: 粘贴你的API密钥。
    *   `BASE_URL`: 粘贴你的API地址。
    *   `MODEL_NAME`: 填写你使用的模型名称，比如 `gemini-1.5-pro-latest`。
    *   **GAME_DIRECTORY**: 这是重中之重！找到你游戏文件夹里的那个 `game` 文件夹。在文件夹上右键，选择“复制地址”或“复制为路径”。粘贴到脚本的 `r''` 引号内。
        *   **示例**: `GAME_DIRECTORY = r'G:\你要翻译的游戏\game'`
    *   `OVERWRITE_FILES`: **强烈建议保持 `False`！** 这会为你创建 `.new.rpy` 新文件，而不是直接覆盖原文件，给你留了后悔药。

3.  **运行脚本**:
    1.  打开CMD，切换到你存放脚本的盘符（例如 `H:`）。
    2.  使用 `cd` 命令进入脚本所在的目录（例如 `cd H:\MyTools`）。
    3.  执行脚本，输入 `python 你的脚本名.py` (例如 `python 123.py`)。
    4.  看到警告后，输入 `yes` 并回车。

**(有报错是正常的哈，毕竟API有波动就有抽风的情况，报错少可以选择手动提取或者直接翻源码，报错超多建议检查网络或配置后重新来过。)**

**收获成果**:
处理完成后，回到你的游戏 `game` 文件夹，你会发现多了很多以 `.new.rpy` 结尾的新文件。这些就是被神器加好标记的文件！（所有子目录下都会有，不光是在game下）

---

## 第三步：铸造灵魂！【术语表铸造熔炉】

翻译的灵魂在于统一。这个工具能帮你把所有角色名都抓出来，做成一个Excel术语表。

**操作流程：**

1.  **创建并配置脚本**: 和上一步一样，把第二个脚本的代码保存为`.py`文件（比如`456.py`），并修改其中的`GAME_DIRECTORY`路径。
2.  **运行脚本**: 在同一个命令行窗口里，输入 `python 456.py` 然后回车。

**收获成果**:
脚本运行完毕后，你会在脚本所在的文件夹里发现一个名为 `glossary.xlsx` 的Excel文件。打开它，在 `dst` 列填上对应的中文译名即可！

---

## 第四步：关键检查与替换

强烈推荐使用 **Beyond Compare**, **WinMerge** 或 **VS Code** 的对比功能，来检查 `.new.rpy` 文件与原文件的差异，确保AI的修改符合预期。

**对比完成后，在所有文件都审核合并完毕后，手动将对比过的`.new.rpy`全部删除，过河拆桥了属于是！**

---

## 第五步：施展终极魔法！【字体替换魔法卷轴】

为了让你的中文翻译能在游戏里完美显示，而不是变成一堆方块“□□□”，我们需要这最后一道魔法。

**操作流程：**

1.  **准备中文字体** (`.ttf` 或 `.otf` 格式)。
2.  在 `game/` 目录下，创建文件夹 `tl/Chinese/fonts`，把字体文件放进去。
3.  在 `game/` 目录下，新建一个 `z_font_hack.rpy` 文件，把第三个脚本的代码复制进去。
4.  **配置卷轴**: 打开 `z_font_hack.rpy`，修改 `font_replacement_map`，左边是游戏原英文字体名，右边是你准备好的中文字体路径。

---

## 第六步：开始翻译，老K，lingua联合启动！

1.  现在启动 Ren'Py Launcher，选择你的项目，点击**生成翻译文件**。
2.  使用老K工具的“移动”功能，把所有子文件夹里的`.rpy`文件都挪到`Chinese`根目录下。
3.  把这些`.rpy`文件扔到Lingua里，配置好接口、术语表和专用提示词，开始批量翻译。
4.  翻译完成后，将`output`文件夹里的文件替换回去。
5.  用老K工具的“还原”功能，把文件都放回原来的子目录。

---

## 更新：关于道德审核与超大文件的手动解决方案

如果遇到API不合作或文件过大的情况，我们可以切换到手动模式。

### 开启“神之眼” (Global Search with Regex)

1.  用 **VS Code** 打开你的高风险文件。
2.  按下 `Ctrl + Shift + F`，打开全局搜索，并**启用正则表达式** (`.*`图标)。
3.  输入下面的“索敌咒语”进行查找。

### 【你的专属正则咒语库】

*   **咒语一：查找 `renpy.input()`**
    ```regex
    renpy\.input\s*\(\s*"([^"]+)"
    ```
*   **咒语二：查找 `Character()`**
    ```regex
    Character\s*\(\s*"([^"]+)"
    ```
*   **咒语三：查找 `show text`**
    ```regex
    show\s+text\s+"([^"]+)"
    ```
*   **咒语四：查找变量赋值的长字符串**
    ```regex
    \$\s*\w+\s*=\s*"([^"]{10,})"
    ```
*   **咒语五：查找通用函数调用参数**
    ```regex
    \w+\s*\(\s*[^)]*\b"([^"/]+?)"
    ```

### 手动“点穴” (Manual Application of `_()`)

根据搜索结果，跳转到对应代码行，手动为需要翻译的文本加上`_()`。
**这个方案的巨大优势**: 零API成本、无视道德审核、速度极快、精准可控、无视文件大小！

---

恭喜你！你已经掌握了这套神器的使用方法了！去汉化吧，英雄！
